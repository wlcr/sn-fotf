/* View Transitions API styles - Route-based animation system */

/* Respect user's motion preferences - no animations for reduced motion */
@media (prefers-reduced-motion: reduce) {
  ::view-transition-group(root) {
    animation: none !important;
  }
  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation: none !important;
  }
}

/* Enable view transitions for supported browsers */
@supports (view-transition-name: none) {
  @media (prefers-reduced-motion: no-preference) {
    /* =================================
       HEADER WITH SUBTLE FADE
       ================================= */
    /* Give the main site header a consistent view-transition-name for subtle animations */
    /* Only apply to the main site header, not page-specific headers */
    .main-header-transitions {
      view-transition-name: header;
    }

    /* Header gets a subtle fade only - no movement */
    ::view-transition-old(header) {
      animation: header-subtle-fade-out var(--vt-duration, 500ms) ease-in-out;
    }

    ::view-transition-new(header) {
      animation: header-subtle-fade-in var(--vt-duration, 500ms) ease-in-out;
    }

    /* =================================
       MINIMUM DURATION GUARANTEE
       ================================= */
    /* Ensure all view transitions have a minimum perceivable duration */
    ::view-transition-group(root) {
      animation-duration: var(--vt-duration, 500ms) !important;
    }

    /* Force minimum duration for header transitions too */
    ::view-transition-group(header) {
      animation-duration: var(--vt-duration, 500ms) !important;
    }

    /* =================================
       DEFAULT ANIMATION - Smooth fade with subtle color
       ================================= */
    body:not(.wine-glass-tilt-transition):not(.wine-swirl-transition):not(
        .vineyard-slide-transition
      ):not(.reveal-curtain-transition):not(.subtle-transition)
      ::view-transition-group(root) {
      animation-duration: 500ms;
    }

    /* =================================
       CUSTOM PROPERTIES APPROACH - More reliable for View Transitions
       ================================= */

    /* Initialize CSS variables */
    :root {
      --vt-duration: 500ms;
      --vt-old-animation: default-fade-out;
      --vt-new-animation: default-fade-in;
      --vt-bg-color: color-mix(
        in srgb,
        var(--color-brand-maroon-2) 30%,
        transparent
      );
    }

    /* Apply custom properties to pseudo-elements */
    ::view-transition-old(root) {
      animation: var(--vt-old-animation) var(--vt-duration) ease-in-out !important;
    }

    ::view-transition-new(root) {
      animation: var(--vt-new-animation) var(--vt-duration) ease-in-out !important;
    }

    /* Background color applied to the group container for better visibility */
    ::view-transition-group(root) {
      background: var(--vt-bg-color) !important;
    }

    /* Route-specific custom property sets */
    body.wine-glass-tilt-transition {
      --vt-duration: 900ms;
      --vt-old-animation: glass-tilt-out;
      --vt-new-animation: glass-tilt-in;
      --vt-bg-color: color-mix(
        in srgb,
        var(--color-brand-maroon) 85%,
        transparent
      );
    }

    body.wine-swirl-transition {
      --vt-duration: 700ms;
      --vt-old-animation: swirl-out;
      --vt-new-animation: swirl-in;
      --vt-bg-color: color-mix(
        in srgb,
        var(--color-brand-orange) 80%,
        transparent
      );
    }

    body.vineyard-slide-transition {
      --vt-duration: 600ms;
      --vt-old-animation: vineyard-slide-out;
      --vt-new-animation: vineyard-slide-in;
      --vt-bg-color: color-mix(
        in srgb,
        var(--color-brand-maroon-2) 80%,
        transparent
      );
    }

    body.reveal-curtain-transition {
      --vt-duration: 800ms;
      --vt-old-animation: curtain-reveal-out;
      --vt-new-animation: curtain-reveal-in;
      --vt-bg-color: color-mix(
        in srgb,
        var(--color-brand-maroon) 90%,
        transparent
      );
    }

    body.subtle-transition {
      --vt-duration: 400ms;
      --vt-old-animation: subtle-fade-out;
      --vt-new-animation: subtle-fade-in;
      --vt-bg-color: color-mix(
        in srgb,
        var(--color-brand-cream) 75%,
        var(--color-brand-maroon) 25%
      );
    }

    /* =================================
       DEFAULT KEYFRAMES - Smooth crossfade
       ================================= */
    @keyframes default-fade-out {
      from {
        opacity: 1;
        transform: scale(1);
      }
      to {
        opacity: 0;
        transform: scale(0.98);
      }
    }

    @keyframes default-fade-in {
      from {
        opacity: 0;
        transform: scale(1.02);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes glass-tilt-out {
      from {
        opacity: 1;
        transform: perspective(1000px) rotateY(0deg) rotateX(0deg) translateY(0)
          scale(1);
      }
      to {
        opacity: 0;
        transform: perspective(1000px) rotateY(-8deg) rotateX(3deg)
          translateY(-20px) scale(0.95);
      }
    }

    @keyframes glass-tilt-in {
      from {
        opacity: 0;
        transform: perspective(1000px) rotateY(8deg) rotateX(-3deg)
          translateY(20px) scale(1.05);
      }
      to {
        opacity: 1;
        transform: perspective(1000px) rotateY(0deg) rotateX(0deg) translateY(0)
          scale(1);
      }
    }

    /* =================================
       KEYFRAME ANIMATIONS
       ================================= */

    @keyframes swirl-out {
      from {
        opacity: 1;
        transform: scale(1) rotate(0deg);
      }
      to {
        opacity: 0;
        transform: scale(0.9) rotate(-15deg);
      }
    }

    @keyframes swirl-in {
      from {
        opacity: 0;
        transform: scale(1.1) rotate(15deg);
      }
      to {
        opacity: 1;
        transform: scale(1) rotate(0deg);
      }
    }

    @keyframes vineyard-slide-out {
      from {
        opacity: 1;
        transform: translateX(0) scale(1);
      }
      to {
        opacity: 0;
        transform: translateX(-30%) scale(0.95);
      }
    }

    @keyframes vineyard-slide-in {
      from {
        opacity: 0;
        transform: translateX(30%) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateX(0) scale(1);
      }
    }

    @keyframes curtain-reveal-out {
      from {
        opacity: 1;
        transform: translateY(0) scale(1);
        clip-path: inset(0 0 0 0);
      }
      to {
        opacity: 0;
        transform: translateY(-10px) scale(0.98);
        clip-path: inset(0 0 100% 0);
      }
    }

    @keyframes curtain-reveal-in {
      from {
        opacity: 0;
        transform: translateY(10px) scale(0.98);
        clip-path: inset(100% 0 0 0);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
        clip-path: inset(0 0 0 0);
      }
    }

    @keyframes subtle-fade-out {
      from {
        opacity: 1;
        transform: scale(1);
      }
      to {
        opacity: 0;
        transform: scale(0.98);
      }
    }

    @keyframes subtle-fade-in {
      from {
        opacity: 0;
        transform: scale(1.02);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Header animations - subtle fade only, no movement */
    @keyframes header-subtle-fade-out {
      from {
        opacity: 1;
      }
      to {
        opacity: 0.7;
      }
    }

    @keyframes header-subtle-fade-in {
      from {
        opacity: 0.7;
      }
      to {
        opacity: 1;
      }
    }

    /* Original header animations with movement (kept for reference) */
    @keyframes header-fade-out {
      from {
        opacity: 1;
        transform: translateY(0);
      }
      to {
        opacity: 0.7;
        transform: translateY(-2px);
      }
    }

    @keyframes header-fade-in {
      from {
        opacity: 0.7;
        transform: translateY(2px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  } /* End of prefers-reduced-motion: no-preference */
} /* End of @supports (view-transition-name: none) */

/* Fallback for browsers without view transitions */
@supports not (view-transition-name: none) {
  @media (prefers-reduced-motion: no-preference) {
    .page-content {
      opacity: 0;
      transform: translateY(20px);
      transition:
        opacity 300ms ease-out,
        transform 300ms ease-out;
    }

    .page-content.loaded {
      opacity: 1;
      transform: translateY(0);
    }
  }
}
